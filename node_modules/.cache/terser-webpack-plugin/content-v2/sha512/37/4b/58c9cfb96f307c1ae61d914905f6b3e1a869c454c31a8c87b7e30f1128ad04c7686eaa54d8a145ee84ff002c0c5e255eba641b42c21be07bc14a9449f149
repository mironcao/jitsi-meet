{"map":"{\"version\":3,\"sources\":[\"flacEncodeWorker.min.js\"],\"names\":[\"modules\",\"installedModules\",\"__webpack_require__\",\"moduleId\",\"exports\",\"module\",\"i\",\"l\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"__webpack_exports__\",\"_defineProperty\",\"obj\",\"configurable\",\"writable\",\"self\",\"FLAC_SCRIPT_LOCATION\",\"importScripts\",\"FLAC_ERRORS\",\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"EncoderState\",\"freeze\",\"UNINTIALIZED\",\"WORKING\",\"FINISHED\",\"Encoder\",\"[object Object]\",\"sampleRate\",\"bitDepth\",\"bufferSize\",\"this\",\"Flac\",\"isReady\",\"Error\",\"_sampleRate\",\"_bitDepth\",\"_bufferSize\",\"_encoderId\",\"init_libflac_encoder\",\"init_encoder_stream\",\"_onEncodedData\",\"_onMetadataAvailable\",\"_state\",\"audioData\",\"bufferLength\",\"length\",\"bufferI32\",\"Int32Array\",\"view\",\"DataView\",\"buffer\",\"index\",\"setInt32\",\"FLAC__stream_encoder_process_interleaved\",\"errorNo\",\"FLAC__stream_encoder_get_state\",\"console\",\"error\",\"status\",\"FLAC__stream_encoder_finish\",\"log\",\"FLAC__stream_encoder_delete\",\"_data\",\"_exportFlacBlob\",\"samples\",\"arrays\",\"totalLength\",\"result\",\"Uint8Array\",\"offset\",\"len\",\"set\",\"mergeUint8Arrays\",\"_flacBuffers\",\"_flacLength\",\"Blob\",\"type\",\"bytes\",\"push\",\"byteLength\",\"encoder\",\"onmessage\",\"e\",\"data\",\"command\",\"bps\",\"config\",\"postMessage\",\"onready\",\"setTimeout\",\"encode\",\"buf\",\"finish\",\"getBlob\"],\"mappings\":\"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\"}","code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"/libs/\",n(n.s=0)}([function(e,t,n){\"use strict\";n.r(t);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}self.FLAC_SCRIPT_LOCATION=\"/libs/\",importScripts(\"/libs/libflac4-1.3.2.min.js\");const i={0:\"FLAC__STREAM_ENCODER_OK\",1:\"FLAC__STREAM_ENCODER_UNINITIALIZED\",2:\"FLAC__STREAM_ENCODER_OGG_ERROR\",3:\"FLAC__STREAM_ENCODER_VERIFY_DECODER_ERROR\",4:\"FLAC__STREAM_ENCODER_VERIFY_MISMATCH_IN_AUDIO_DATA\",5:\"FLAC__STREAM_ENCODER_CLIENT_ERROR\",6:\"FLAC__STREAM_ENCODER_IO_ERROR\",7:\"FLAC__STREAM_ENCODER_FRAMING_ERROR\",8:\"FLAC__STREAM_ENCODER_MEMORY_ALLOCATION_ERROR\"},o=Object.freeze({UNINTIALIZED:\"uninitialized\",WORKING:\"working\",FINISHED:\"finished\"});class a{constructor(e,t=16,n=4096){if(r(this,\"_encoderId\",0),r(this,\"_flacBuffers\",[]),r(this,\"_flacLength\",0),r(this,\"_state\",o.UNINTIALIZED),r(this,\"_data\",null),r(this,\"_onMetadataAvailable\",()=>{}),!Flac.isReady())throw new Error(\"libflac is not ready yet!\");if(this._sampleRate=e,this._bitDepth=t,this._bufferSize=n,this._encoderId=Flac.init_libflac_encoder(this._sampleRate,1,this._bitDepth,5,0,!0,0),0===this._encoderId)throw new Error(\"Failed to create libflac encoder.\");if(0!==Flac.init_encoder_stream(this._encoderId,this._onEncodedData.bind(this),this._onMetadataAvailable.bind(this)))throw new Error(\"Failed to initalise libflac encoder.\");this._state=o.WORKING}encode(e){if(this._state!==o.WORKING)throw new Error(\"Encoder is not ready or has finished.\");if(!Flac.isReady())throw new Error(\"Flac not ready\");const t=e.length,n=new Int32Array(t),r=new DataView(n.buffer);let a=0;for(let n=0;n<t;n++)r.setInt32(a,32767*e[n],!0),a+=4;if(1!==Flac.FLAC__stream_encoder_process_interleaved(this._encoderId,n,n.length)){const e=Flac.FLAC__stream_encoder_get_state(this._encoderId);console.error(\"Error during encoding\",i[e])}}finish(){if(this._state===o.WORKING){this._state=o.FINISHED;const e=Flac.FLAC__stream_encoder_finish(this._encoderId);console.log(\"Flac encoding finished: \",e),Flac.FLAC__stream_encoder_delete(this._encoderId),this._data=this._exportFlacBlob()}}getBlob(){return this._state===o.FINISHED?this._data:null}_exportFlacBlob(){const e=function(e,t){const n=new Uint8Array(t);let r=0;const i=e.length;for(let t=0;t<i;t++){const i=e[t];n.set(i,r),r+=i.length}return n}(this._flacBuffers,this._flacLength);return new Blob([e],{type:\"audio/flac\"})}_onEncodedData(e,t){this._flacBuffers.push(e),this._flacLength+=e.byteLength}}let s=null;self.onmessage=function(e){switch(e.data.command){case\"MAIN_THREAD_INIT\":{const t=e.data.config.bps,n=e.data.config.sampleRate;Flac.isReady()?(s=new a(n,t),self.postMessage({command:\"WORKER_LIBFLAC_READY\"})):Flac.onready=function(){setTimeout(()=>{s=new a(n,t),self.postMessage({command:\"WORKER_LIBFLAC_READY\"})},0)};break}case\"MAIN_THREAD_NEW_DATA_ARRIVED\":null===s?console.error(\"flacEncoderWorker received data when the encoder is not ready.\"):s.encode(e.data.buf);break;case\"MAIN_THREAD_FINISH\":if(null!==s){s.finish();const e=s.getBlob();self.postMessage({command:\"WORKER_BLOB_READY\",buf:e}),s=null}}}}]);","extractedComments":[]}